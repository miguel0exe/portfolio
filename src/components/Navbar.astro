---
import { Icon } from "astro-icon/components";

const navItems = [
  {
    title: "Inicio",
    label: "inicio",
    url: "/#",
    icon: "mdi:home-outline",
  },
  {
    title: "Misiones",
    label: "experiencia",
    url: "/#experiencia",
    icon: "mdi:scroll-text-outline",
  },
  // {
  //   title: "Grimorio",
  //   label: "proyectos",
  //   url: "/#proyectos",
  //   icon: "mdi:book-open-page-variant-outline",
  // },
  {
    title: "Personaje",
    label: "sobre-mi",
    url: "/#sobre-mi",
    icon: "mdi:account-box-outline",
  },
  {
    title: "Invocar",
    label: "footer",
    url: "mailto:miguel.emezero@gmail.com",
    icon: "mdi:email-outline",
  },
];
---

<nav class="fixed top-6 left-1/2 -translate-x-1/2 z-50 hidden md:block">
  <div
    class="relative flex items-center gap-8 px-8 py-3 bg-[#0c0a09]/90 backdrop-blur-md border-y-2 border-[#C8AA6E]/40 rounded-full shadow-[0_10px_30px_rgba(0,0,0,0.8)] clip-path-hud"
  >
    <div
      class="absolute left-2 top-1/2 -translate-y-1/2 w-2 h-2 bg-[#C8AA6E] rotate-45 shadow-[0_0_10px_#C8AA6E]"
    >
    </div>
    <div
      class="absolute right-2 top-1/2 -translate-y-1/2 w-2 h-2 bg-[#C8AA6E] rotate-45 shadow-[0_0_10px_#C8AA6E]"
    >
    </div>

    {
      navItems.map((link) => (
        <a
          href={link.url}
          aria-label={link.label}
          class="nav-link relative group flex flex-col items-center justify-center"
          data-section={link.label}
        >
          <span class="font-cinzel text-sm font-bold text-[#78716c] tracking-widest group-hover:text-[#C8AA6E] transition-colors duration-300">
            {link.title}
          </span>

          <span class="absolute -bottom-2 w-1 h-1 bg-[#C8AA6E] rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300 shadow-[0_0_8px_#C8AA6E]" />
        </a>
      ))
    }
  </div>
</nav>

<nav
  class="fixed bottom-4 left-1/2 -translate-x-1/2 z-50 md:hidden w-[90%] max-w-sm"
>
  <div
    class="flex justify-between items-center bg-[#1c1917]/95 border border-[#44403c] rounded-lg p-2 shadow-2xl relative overflow-hidden"
  >
    <div
      class="absolute top-0 left-0 right-0 h-[1px] bg-gradient-to-r from-transparent via-[#C8AA6E]/50 to-transparent"
    >
    </div>

    {
      navItems.map((link) => (
        <a
          href={link.url}
          aria-label={link.label}
          class="nav-link-mobile relative p-3 rounded border border-transparent hover:border-[#C8AA6E]/30 hover:bg-[#C8AA6E]/10 transition-all active:scale-95 group"
        >
          <Icon
            name={link.icon}
            class="w-6 h-6 text-[#a8a29e] group-hover:text-[#C8AA6E] transition-colors"
          />

          <span class="absolute -top-10 left-1/2 -translate-x-1/2 bg-[#0c0a09] border border-[#C8AA6E] text-[#C8AA6E] text-[10px] uppercase tracking-widest px-2 py-1 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap">
            {link.title}
          </span>
        </a>
      ))
    }
  </div>
</nav>

<script>
  /* LÓGICA DE ILUMINACIÓN DE RUNAS (Intersection Observer) */
  const sections = document.querySelectorAll("section, footer"); // Observamos secciones y footer
  const navLinksDesktop = document.querySelectorAll(".nav-link");
  const navLinksMobile = document.querySelectorAll(".nav-link-mobile");

  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          // Limpiar clases activas
          navLinksDesktop.forEach((link) => {
            link
              .querySelector("span")
              ?.classList.remove("text-[#C8AA6E]", "text-shadow-glow");
            link.querySelector("span")?.classList.add("text-[#78716c]");
            link
              .querySelector("span:last-child")
              ?.classList.remove("opacity-100"); // El punto
          });

          navLinksMobile.forEach((link) => {
            link.classList.remove("bg-[#C8AA6E]/10", "border-[#C8AA6E]/30");
            link.querySelector("svg")?.classList.remove("text-[#C8AA6E]");
          });

          // Activar la runa correcta
          const id = entry.target.id || "footer"; // Si es el footer, usameos 'footer'
          // Mapeo manual porque los IDs de sección son español y los links usan #hash
          let targetLabel = "";
          if (id === "experiencia") targetLabel = "experiencia";
          if (id === "proyectos") targetLabel = "proyectos";
          if (id === "sobre-mi") targetLabel = "sobre-mi";
          if (entry.target.tagName === "FOOTER") targetLabel = "footer";

          // Activar Desktop
          const activeDesktop = document.querySelector(
            `.nav-link[aria-label="${targetLabel}"]`,
          );
          if (activeDesktop) {
            activeDesktop
              .querySelector("span")
              ?.classList.remove("text-[#78716c]");
            activeDesktop
              .querySelector("span")
              ?.classList.add("text-[#C8AA6E]", "text-shadow-glow");
            activeDesktop
              .querySelector("span:last-child")
              ?.classList.add("opacity-100");
          }

          // Activar Mobile
          const activeMobile = document.querySelector(
            `.nav-link-mobile[aria-label="${targetLabel}"]`,
          );
          if (activeMobile) {
            activeMobile.classList.add(
              "bg-[#C8AA6E]/10",
              "border-[#C8AA6E]/30",
            );
            activeMobile.querySelector("svg")?.classList.add("text-[#C8AA6E]");
          }
        }
      });
    },
    {
      threshold: 0.2, // Se activa al 20% de visibilidad
      rootMargin: "-10% 0px -50% 0px", // Ajuste para que el centro de la pantalla sea el trigger
    },
  );

  sections.forEach((s) => observer.observe(s));
</script>

<style>
  /* Efecto de brillo de texto para runas activas */
  .text-shadow-glow {
    text-shadow: 0 0 10px rgba(200, 170, 110, 0.6);
  }
</style>
